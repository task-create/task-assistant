<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Employment Assistant</title>
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"/>
<meta name="theme-color" content="#FFFFFF">
<script src="https://unpkg.com/tone"></script>
<style>
:root{
  --radius: 20px;
  --bg: #f4f7fa;
  --surface: #ffffff;
  --surface-2: #f7fbff;
  --text: #0a121e;
  --muted: #5a6b82;
  --brand: #E34A27; /* TASK Red-Orange */
  --accent: #003B5C; /* TASK Dark Blue */
  --border: #e2e8f0;
  --link: var(--brand);
  --shadow: 0 20px 40px rgba(30, 50, 80, .1);
  --shadow-soft: 0 8px 20px rgba(30, 50, 80, .08);
  --header-bg: rgba(255, 255, 255, 0.7);
  --header-border: #d9e2ec;
  --bubble-bot-bg: #e9eef3;
  --bubble-bot-text: #111827;
  --bubble-user-bg: var(--brand);
  --bubble-user-text: #fff;
  --typing: #aab4c3;
}
/* DARK MODE */
[data-theme="dark"]{
  --bg: #0a0f1a;
  --surface: #111929;
  --surface-2: #0e1625;
  --text: #eaf2ff;
  --muted: #a7bad5;
  --border: #344b6b;
  --link: #ff8a6b;
  --header-bg: rgba(17, 25, 41, 0.7);
  --header-border: #344b6b;
  --bubble-bot-bg: #1e293b;
  --bubble-bot-text: #eaf2ff;
  --shadow: 0 22px 46px rgba(0,0,0,.6);
  --shadow-soft: 0 12px 28px rgba(0,0,0,.45);
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:"Open Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:var(--bg); color:var(--text); display:flex; align-items:center; justify-content:center;
  font-size:clamp(15px, 1.6vw, 17px); min-height:100vh;
}
a{color:var(--link);text-decoration:none;font-weight:600} a:hover{text-decoration:underline}
.app{
  width:100%; max-width:560px; background:var(--surface); border:1px solid var(--border); border-radius:var(--radius);
  overflow:hidden; box-shadow:var(--shadow); display:flex; flex-direction:column; height:100vh; position:relative;
}
.header{
  position: absolute; top: 0; left: 0; right: 0; z-index: 100;
  background: var(--header-bg);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border-bottom:1px solid var(--header-border); 
  padding:12px 56px; text-align:center;
}
.badge{
  display:inline-block; background: var(--surface); color:var(--text); padding:8px 20px; border-radius:999px;
  font:800 16px/1 "Nunito", sans-serif; cursor:pointer;
  border: 1px solid var(--border); box-shadow: var(--shadow-soft);
}
.icon-btn {
  position:absolute; top:10px; width:44px; height:44px; border:none; border-radius:50%; background:transparent;
  color:var(--muted); cursor:pointer; transition:all .2s ease; font-size: 20px;
  display: flex; align-items: center; justify-content: center;
}
.icon-btn:hover { color: var(--text); background: rgba(0,0,0,0.05); }
.icon-btn:active { transform: scale(.95); }
.reset{left:10px;}
.settings-btn {right:10px;}

.settings-menu{position:absolute;top:60px;right:10px;background:var(--surface);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow-soft);display:none;min-width:180px;z-index:200}
.settings-menu[aria-hidden="false"]{display:block}
.settings-menu button{display:flex; gap: 8px; align-items: center; width:100%;text-align:left;padding:10px 12px;background:transparent;border:none;cursor:pointer; color: var(--text);}
.settings-menu button:hover{background:var(--surface-2)}
.langmenu { right: 10px; }

.chat{
  flex:1; overflow-y:auto; overflow-x:hidden; padding:20px; padding-top: 80px; padding-bottom:120px; overscroll-behavior:contain; -webkit-overflow-scrolling:touch;
  background: var(--surface-2);
}
.bubble-wrapper { display: flex; align-items: flex-end; gap: 8px; margin: 20px 0; max-width: 92%; animation: pop-in .3s cubic-bezier(0.25, 1, 0.5, 1); }
.bot-bubble-wrapper { margin-right: 18%; }
.user-bubble-wrapper { margin-left: 18%; flex-direction: row-reverse; }

.avatar { width: 36px; height: 36px; border-radius: 50%; background:var(--accent); flex-shrink: 0; display: flex; align-items: center; justify-content: center; color: white; font-family: "Nunito", sans-serif; font-weight: 700; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.bubble{padding:14px 18px;border-radius:18px;line-height:1.5;box-shadow:var(--shadow-soft); transition:box-shadow .15s ease,transform .08s ease}
.bubble.bot{background:var(--bubble-bot-bg); color: var(--bubble-bot-text); border:1px solid var(--border); border-radius: 18px 18px 18px 4px;}
.bubble.user{color:var(--bubble-user-text); background:var(--bubble-user-bg); border:none; border-radius:18px 18px 4px 18px; box-shadow: 0 4px 14px rgba(227, 74, 39, 0.3);}
.bubble:hover{box-shadow:0 10px 22px rgba(20,80,120,.14); transform: translateY(-1px);}
@keyframes pop-in { from { opacity: 0; transform: translateY(10px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
.ctrl{
  display: inline-flex; align-items: center; gap: 8px;
  border:1px solid var(--border); background:var(--surface); border-radius:999px; padding:12px 18px;
  font-weight:600; cursor:pointer; transition:all .12s ease;
  color:var(--text); font-size: 15px;
}
.ctrl:hover { transform: translateY(-2px); border-color: var(--accent); color: var(--accent); box-shadow: var(--shadow-soft); }
.ctrl:active{transform:scale(.98)}
.ctrl:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
.typing{display:inline-flex;gap:6px;align-items:flex-end}
.typing .dot{width:6px;height:6px;border-radius:50%;background:var(--typing);animation:bounce 1s infinite ease-in-out}
.typing .dot:nth-child(2){animation-delay:.12s}.typing .dot:nth-child(3){animation-delay:.24s}
@keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.6}40%{transform:translateY(-6px);opacity:1}}
@media (prefers-reduced-motion: reduce){.typing .dot{animation:none}}
.footer{position:absolute;bottom:0;left:0;right:0;padding:12px;background:var(--surface-2);border-top:1px solid var(--border);z-index:100}
.row{display:flex;gap:10px;align-items:center}
#box{flex:1;padding:14px 50px 14px 18px;border:2px solid var(--border);border-radius:999px;font-size:16px;background:var(--surface);color:var(--text);caret-color:var(--accent); box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);}
.magic-btn { position: absolute; right: 75px; top: 18px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--muted); transition: transform 0.2s ease, color 0.2s ease; }
.magic-btn:hover { transform: scale(1.2); color: var(--accent); }

.send{width:52px;height:52px;border:none;border-radius:50%;cursor:pointer;color:white;font-size:18px;background:var(--brand);box-shadow:var(--shadow-soft);transition:transform .1s ease, background .1s ease;}
.send:hover { background: var(--accent); }
.send:active{transform:scale(.95)}
.status{margin-top:6px;text-align:center;font-size:11px;color:var(--muted)}
/* --- Cards --- */
.card-base {
  background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
  padding: 16px; box-shadow: var(--shadow-soft); margin-bottom: 16px;
  animation: pop-in .5s cubic-bezier(0.25, 1, 0.5, 1) backwards;
}
.card-base h3 { font-family: "Nunito", sans-serif; font-size: 18px; color: var(--accent); margin-bottom: 8px; }
.card-base p { margin-bottom: 12px; line-height: 1.5; }
.card-base .ctrl { background: var(--surface-2); }
.job-card { margin-top: 10px; }
.job-card strong { display: block; font-family: "Nunito", sans-serif; }
.job-card span { color: var(--muted); font-size: 14px; }
</style>
</head>
<body>
<main class="app">
<header class="header">
  <button class="reset icon-btn" id="resetBtn" aria-label="Clear chat">‚Ü∫</button>
  <div class="badge" id="scrollTopBtn" tabindex="0" role="button" aria-label="Scroll to top">Employment Assistant</div>
  <button class="settings-btn icon-btn" id="settingsBtn" aria-label="Settings menu" aria-haspopup="menu" aria-expanded="false">...</button>
  <div class="settings-menu" id="settingsMenu" role="menu" aria-hidden="true">
    <button role="menuitem" id="micBtn">üéôÔ∏è Voice Input</button>
    <button role="menuitem" id="langBtn">üåê Language</button>
    <button role="menuitem" id="themeToggle">üåó Theme</button>
  </div>
   <div class="langmenu" id="langMenu" role="menu" aria-hidden="true">
    <button role="menuitem" data-lang="en">English</button>
    <button role="menuitem" data-lang="es">Espa√±ol</button>
    <button role="menuitem" data-lang="ht">Krey√≤l Ayisyen</button>
  </div>
</header>

<section class="chat" id="chat" role="log" aria-live="polite" aria-relevant="additions" aria-label="Chat transcript"></section>

<footer class="footer">
  <div class="row" style="position: relative;">
    <label class="visually-hidden" for="box">Type a message</label>
    <input id="box" type="text" placeholder="Ask me anything..." autocomplete="off"/>
    <button class="magic-btn" id="magicBtn" aria-label="Show suggestions">‚ú®</button>
    <button class="send" id="send" aria-label="Send">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" /></svg>
    </button>
  </div>
  <div class="status">‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info.</div>
</footer>
</main>

<script>
'use strict';

/* ================= UI STRINGS ================= */
const UI = {
  en:{welcome:'üëã Hi there! How can I help you today?',
      hello:'Hi! üëã How can I help today?',
      thanks:"You're welcome! üòä Is there anything else?",
      bye:'Take care! If you need to schedule, call (609) 337-1624.',
      noWalk:'We do <strong>not</strong> take walk-ins. Please call to schedule. Same-day may be possible if you call first.',
      frust:'I understand this can be frustrating, and I\'m sorry you\'re having trouble. Let\'s try something else. Here are our main phone numbers for direct help:'},
  es:{welcome:'üëã ¬°Hola! ¬øEn qu√© te puedo ayudar hoy?',
      hello:'¬°Hola! üëã ¬øEn qu√© te puedo ayudar hoy?',
      thanks:'¬°Con gusto! üòä ¬øAlgo m√°s?',bye:'¬°Cu√≠date! Si necesitas una cita, llama al (609) 337-1624.',
      noWalk:'No atendemos <strong>sin cita</strong>. Por favor llama para programar.',
      frust:'Entiendo que esto puede ser frustrante y lamento que tengas problemas. Probemos otra cosa. Aqu√≠ est√°n nuestros n√∫meros de tel√©fono principales para obtener ayuda directa:'},
  ht:{welcome:'üëã Bonjou! Kijan mwen ka ede w jodi a?',
      hello:'Bonjou! üëã Kijan mwen ka ede w jodi a?',
      thanks:'Av√®k plezi! üòä Gen l√≤t bagay?',bye:'Si ou bezwen randevou, rele (609) 337-1624.',
      noWalk:'Nou pa pran <strong>san randevou</strong>. Tanpri rele pou pran randevou.',
      frust:'Mwen konprann sa ka fwistre, e mwen regr√®t ou gen pwobl√®m. Ann eseye yon l√≤t bagay. Men nimewo telef√≤n prensipal nou yo pou jwenn √®d dir√®k:'}
};


/* ================= DATA & STATE ================= */
let lang='en';
const ce=id=>document.getElementById(id);
const chat=ce('chat'), box=ce('box'), theme=ce('themeToggle');
const resetBtn=ce('resetBtn');
const langBtn=ce('langBtn'), langMenu=ce('langMenu');
const settingsBtn = ce('settingsBtn'), settingsMenu = ce('settingsMenu');
const micBtn = ce('micBtn');
let chatHistory = [];

/* ================= SOUND & HAPTICS ================= */
let synth;
try {
  synth = new Tone.PolySynth(Tone.Synth, {
    oscillator: { type: "sine" },
    envelope: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.2 },
  }).toDestination();
} catch (e) { console.warn("Tone.js failed to initialize."); synth = null; }

function playSound(type) {
  if (synth && Tone.context.state !== 'running') { Tone.start(); }
  if (synth) {
    try { 
      if (type === 'send') synth.triggerAttackRelease("C5", "16n", Tone.now());
      if (type === 'receive') synth.triggerAttackRelease(["E5", "A5"], "16n", Tone.now());
    } catch(e) {}
  }
}
function vibrate(style = 'light') {
  if (window.navigator?.vibrate) {
    try { 
      if (style === 'light') navigator.vibrate(10);
      if (style === 'medium') navigator.vibrate([30, 50, 30]);
    } catch(e) {}
  }
}

/* ================= HELPERS & UI ================= */
const isNearBottom=()=> (chat.scrollHeight - chat.scrollTop - chat.clientHeight) < 80;
function safeScroll(){ if(isNearBottom()) requestAnimationFrame(()=> chat.scrollTop=chat.scrollHeight ); }
function setLang(l,persist=true){ lang=(['en','es','ht'].includes(l)?l:'en'); if(persist){try{localStorage.setItem('task_lang',lang);}catch(e){}} }
window.textInfo = (text) => { const url = `sms:?&body=${encodeURIComponent(text)}`; window.location.href = url; vibrate('medium'); };

settingsBtn.addEventListener('click', () => {
    const open = settingsMenu.getAttribute('aria-hidden') === 'false';
    settingsMenu.setAttribute('aria-hidden', open ? 'true' : 'false');
    settingsBtn.setAttribute('aria-expanded', open ? 'false' : 'true');
});
langBtn.addEventListener('click', () => {
    const open = langMenu.getAttribute('aria-hidden') === 'false';
    langMenu.setAttribute('aria-hidden', open ? 'true' : 'false');
});
langMenu.querySelectorAll('button').forEach(b => b.addEventListener('click', () => {
    setLang(b.dataset.lang);
    langMenu.setAttribute('aria-hidden', 'true');
    settingsMenu.setAttribute('aria-hidden', 'true');
    greet(true);
}));
document.addEventListener('click', (e) => {
    if (!settingsBtn.contains(e.target) && !settingsMenu.contains(e.target) && !langBtn.contains(e.target) && !langMenu.contains(e.target)) {
        settingsMenu.setAttribute('aria-hidden', 'true');
        langMenu.setAttribute('aria-hidden', 'true');
    }
});

/* ================= RENDER ================= */
function addU(t){ const e=document.createElement('div'); e.className='bubble-wrapper user-bubble-wrapper'; e.innerHTML=`<div class="bubble user">${t}</div>`; chat.appendChild(e); safeScroll(); playSound('send'); vibrate('light'); }
function addB(html){
  const wrapper=document.createElement('div');
  wrapper.className='bubble-wrapper bot-bubble-wrapper';
  const avatar = `<div class="avatar" aria-hidden="true">E</div>`;
  const bubble = `<div class="bubble bot">${html}</div>`;
  wrapper.innerHTML = avatar + bubble;
  chat.appendChild(wrapper);
  safeScroll();
  playSound('receive');
  vibrate('light');
}
function typing(on){
  const id='typing';
  if(on){
    const wrapper = document.createElement('div');
    wrapper.id = id;
    wrapper.className = 'bubble-wrapper bot-bubble-wrapper';
    const avatar = `<div class="avatar" aria-hidden="true">E</div>`;
    const bubble = `<div class="bubble bot"><div class="typing" aria-hidden="true"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div></div>`;
    wrapper.innerHTML = avatar + bubble;
    chat.appendChild(wrapper);
  } else { ce(id)?.remove(); }
  safeScroll();
}

/* ================= AI CORE (GEMINI) ================= */
const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=";

const systemPrompt = `
  You are the Employment Assistant for the Trenton Area Soup Kitchen (TASK). 
  Your persona is friendly, empathetic, and extremely helpful. Your goal is to provide clear, actionable information.
  Keep responses concise, using Markdown for links.
  
  ***IMPORTANT RULES***
  1.  **DETECT INTENT**: Analyze the user's message to determine their core need. Handle typos gracefully (e.g., "apointmetn" is "appointment", "tarinign" is "training").
  2.  **HANDLE STAFF**: If the user mentions "Sean", provide his info for training. If they mention "Diani", provide her info for appointments.
  3.  **HANDLE JOBS**: If the user asks for "jobs", ALWAYS ask for the job type first (warehouse, retail, food service). Once they specify a type, respond ONLY with the tag: [SEARCH_JOBS: job_type]. For specific company names (Amazon, UPS, Sodexo, Trane, Aramark, P.F. Chang's, Red Lobster, Cheesecake Factory, Cooper's Riverview, Longhorn Steakhouse), respond ONLY with the tag: [SEARCH_JOBS: company_name].
  4.  **HANDLE TRAINING**: If the user asks for "training", provide the direct application link.
  5.  **PROVIDE INFO**: For all other topics (hours, address, SORA, etc.), provide the information directly.
  6.  **BE CONVERSATIONAL**: Don't just list facts. If a user says "hi", say hi back. If they are frustrated, be empathetic before providing help.

  ***YOUR KNOWLEDGE BASE***
  - **TASK Website**: [https://www.trentonsoupkitchen.org](https://www.trentonsoupkitchen.org)
  - **Appointments**: To make an appointment, call **609-337-1624**. We do NOT take walk-ins.
  - **Sean (Training Contact)**: **609-697-6215**
  - **Diani (Appointment Contact)**: **609-697-6166**
  - **Training Application Link**: [https://bycell.mobi/wap/default/item.jsp?entryid=ECNDE0Mg==&itemid=170659](https://bycell.mobi/wap/default/item.jsp?entryid=ECNDE0Mg==&itemid=170659)
  - **SORA License Info**: Official NJ site is [https://www.njsp.org/private-detective/sora.shtml](https://www.njsp.org/private-detective/sora.shtml)
  - **Career Tips**: Based on [https://bycell.mobi/wap/default/item.jsp?entryid=ECNDE0Mg==&itemid=170675](https://bycell.mobi/wap/default/item.jsp?entryid=ECNDE0Mg==&itemid=170675)
`;

async function getAiResponse(prompt) {
    typing(true);
    chatHistory.push({ role: "user", parts: [{ text: prompt }] });

    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: chatHistory,
                systemInstruction: { parts: [{ text: systemPrompt }] },
                tools: [{ "google_search": {} }]
            })
        });
        if (!response.ok) throw new Error(`API error: ${response.statusText}`);
        const result = await response.json();
        const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "I'm sorry, I'm having trouble connecting right now.";
        
        chatHistory.push({ role: "model", parts: [{ text: text }] });
        return text;

    } catch (error) {
        console.error("Gemini API call failed:", error);
        return "I'm sorry, I encountered an error. Please try again in a moment.";
    } finally {
        typing(false);
    }
}


/* ================= FLOW ================= */
async function handle(t){
  if(!t) return;
  addU(t);
  
  const aiResponse = await getAiResponse(t);

  if (aiResponse.startsWith('[SEARCH_JOBS:')) {
    const jobQuery = aiResponse.match(/\[SEARCH_JOBS:\s*(.+)\]/)[1];
    await getJobs(jobQuery);
  } else {
    const formattedResponse = aiResponse.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
    addB(formattedResponse);
  }
}

async function getJobs(query) {
    addB(`Searching for the latest ${query} jobs in Mercer County...`);
    const jobQuery = `entry level ${query} jobs in Mercer County NJ`;
    const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(jobQuery)}&ibp=htl;jobs`;
    
    let jobsHtml = `Here are some recent ${query} openings. Click the link to see the full list on Google Jobs:`;
    jobsHtml += `<div class="card-base job-card">
        <strong>Live Job Search Results</strong>
        <span>Mercer County, NJ</span>
        <div class="controls"><a href="${searchUrl}" target="_blank" rel="noopener" class="ctrl">View Live Jobs</a></div>
    </div>`;
    addB(jobsHtml);
}

function send(){ const t=(box.value||'').trim(); if(!t) return; handle(t); box.value=''; box.blur(); setTimeout(()=>box.focus(),100); }

/* ================= THEME ================= */
(function initTheme(){
  let saved=null; try{saved=localStorage.getItem('task_theme');}catch(e){}
  if(!saved && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){
    document.documentElement.setAttribute('data-theme','dark');
  } else if(saved){
    document.documentElement.setAttribute('data-theme', saved);
  }
})();
themeToggle.addEventListener('click',()=>{
  const dark=document.documentElement.getAttribute('data-theme')==='dark';
  const next=dark?'light':'dark';
  document.documentElement.setAttribute('data-theme', next);
  try{ localStorage.setItem('task_theme', next); }catch(e){}
});

/* ================= VOICE (if supported) ================= */
(function initMic(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){ micBtn.style.display='none'; return; }
  const rec=new SR(); const langMap={en:'en-US', es:'es-ES', ht:'ht-HT'};
  micBtn.addEventListener('click',()=>{ rec.lang=langMap[lang]||'en-US'; rec.start(); });
  rec.onresult=e=>{ box.value=e.results[0][0].transcript; send(); };
})();

/* ================= EVENTS ================= */
resetBtn.addEventListener('click',()=>{ chat.innerHTML=''; chatHistory=[]; greet(true); });
ce('send').addEventListener('click',send);
box.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); send(); }});
box.addEventListener('focus',()=>setTimeout(()=>safeScroll(),300));
ce('scrollTopBtn').addEventListener('click',()=>chat.scrollTo({top:0,behavior:'smooth'}));

/* ================= GREETING & OPPORTUNITY ENGINE ================= */
async function fetchOpportunities() {
    // In a real app, this would fetch from a live Google Sheet or API
    const mockData = [
      { title: 'üî• Hiring Event Today!', message: 'Amazon is hiring warehouse associates until 3 PM at their Robbinsville location.', link: 'https://search.amazondelivers.jobs/location/new-jersey-jobs', linkText: 'Apply at Amazon' },
      { title: 'UPDATE: Bus Route 609', message: 'The 609 Bus is running on a delayed schedule this morning due to construction.', linkText: 'See Details', link: 'https://www.njtransit.com/service-advisory' },
    ];
    return mockData;
}

ce('magicBtn').addEventListener('click', async () => {
  vibrate('light');
  addB('‚ú® Here are today\'s top opportunities:');
  const opportunities = await fetchOpportunities();
  let oppsHTML = '';
  opportunities.forEach((item, i) => {
    let cardHTML = `<div class="card-base opportunity-card" style="animation-delay: ${i*100}ms"><h3>${item.title}</h3><p>${item.message}</p>`;
    if (item.linkText && item.link) {
      cardHTML += `<div class="controls"><a class="ctrl" href="${item.link}" target="_blank" rel="noopener">${item.linkText}</a></div>`;
    }
    cardHTML += `</div>`;
    oppsHTML += cardHTML;
  });
  addB(oppsHTML);
});


function greet(fromReset=false){
  if(fromReset){
    let saved=null; try{ saved=localStorage.getItem('task_lang'); }catch(e){}
    setLang(saved || 'en');
  }
  const welcomeMessage = UI[lang] ? UI[lang].welcome : UI['en'].welcome;
  addB(`<strong>${welcomeMessage}</strong>`);
}

(function initLang(){ let saved=null; try{ saved=localStorage.getItem('task_lang'); }catch(e){} setLang(saved || 'en'); })();
greet();

</script>
</body>
</html>

