<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>TASK Employment Assistant</title>

<!-- Inline favicon to avoid 404 -->
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='32' fill='%23145078'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-family='Arial' font-size='28' fill='%23fff'%3ET%3C/text%3E%3C/svg%3E" />

<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@800&family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>

<style>
  :root{
    --brand:#FF911F; --accent:#145078; --bg:#0a0f1a; --surface:#111929; --surface-2:#0e1625;
    --text:#eaf2ff; --muted:#a7bad5; --border:#344b6b; --shadow:0 10px 20px rgba(0,0,0,.25);
    --shadow-soft:0 6px 14px rgba(0,0,0,.18); --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Arial,sans-serif;display:flex;align-items:center;justify-content:center;min-height:100vh;}

  /* Container */
  .container{width:100%;max-width:980px;height:100vh;display:flex;flex-direction:column;position:relative;background:var(--surface);
    border:1px solid var(--border);border-radius:22px;box-shadow:var(--shadow);overflow:hidden}
  header{display:flex;align-items:center;justify-content:center;gap:10px;padding:8px 12px;background:var(--surface);border-bottom:1px solid var(--border)}
  header h1{margin:6px 0;font-family:Nunito,sans-serif;font-weight:800;color:var(--accent);font-size:20px}
  .header-right{position:absolute;right:8px;top:8px}
  .icon-btn{width:36px;height:36px;border-radius:50%;border:1px solid var(--border);background:transparent;color:var(--text);
    display:grid;place-items:center;cursor:pointer}
  .chat{flex:1;overflow:auto;background:var(--surface-2);padding:18px 18px 160px}
  .row{display:flex;gap:10px;align-items:flex-start;margin:12px 0}
  .avatar{flex:0 0 30px;height:30px;border-radius:50%;background:var(--accent);color:#fff;display:grid;place-items:center;font-weight:800;font-family:Nunito}
  .bubble{max-width:48%;background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:11px 13px;line-height:1.55;box-shadow:var(--shadow-soft);font-size:16px}
  .user{justify-content:flex-end}
  .user .bubble{background:var(--brand);color:#fff;border-color:transparent;border-radius:16px 16px 6px 16px}
  .bot .bubble{border-radius:16px 16px 16px 6px}
  .bubble ul{margin:.4em 0 .4em 1.2em}
  .bubble li{margin:.2em 0}

  /* Input + status */
  .input-wrap{position:fixed;left:50%;transform:translateX(-50%);bottom:64px;width:100%;max-width:980px;padding:6px 14px;z-index:2}
  .input-row{display:grid;grid-template-columns:46px 1fr 46px;gap:8px;background:var(--surface);border:1px solid var(--border);
    border-radius:999px;padding:8px;box-shadow:var(--shadow-soft)}
  #box{border:0;outline:0;font-size:1rem;background:transparent;color:var(--text)}
  .send-btn{width:46px;height:46px;border:0;border-radius:50%;background:var(--brand);color:#fff;cursor:pointer;display:grid;place-items:center}
  .sparkle-btn{width:46px;height:46px;border:2px solid var(--brand);color:var(--brand);background:transparent;border-radius:50%;
    font-weight:900;cursor:pointer;display:grid;place-items:center}
  .status-line{margin-top:6px;font-size:.9rem;color:var(--muted);padding-left:8px}

  /* Splash */
  #splash{position:fixed;inset:0;background:var(--accent);color:#fff;display:flex;align-items:center;justify-content:center;flex-direction:column;
    font-family:Nunito,sans-serif;gap:16px;text-align:center;z-index:9}
  .splash-card{background:#0f1b2c;border:1px solid rgba(255,255,255,.15);border-radius:16px;padding:26px 24px;box-shadow:var(--shadow);max-width:560px}
  .splash-btn{background:var(--brand);color:#fff;border:2px solid #fff;font-weight:800;border-radius:999px;padding:12px 20px;cursor:pointer}
  .logo{width:120px;height:auto;margin-bottom:10px;border-radius:8px}

  /* Quick actions */
  .quick-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow-soft);margin-bottom:8px}
  .quick-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
  .qbtn{width:100%;text-align:left;background:var(--surface-2);color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px 12px;cursor:pointer}
  .legal{position:fixed;left:50%;transform:translateX(-50%);bottom:0;width:100%;max-width:980px;padding:6px 12px;background:var(--accent);color:#fff;text-align:center;font-size:.85rem}
</style>
</head>
<body>

<!-- Splash -->
<div id="splash" role="dialog" aria-modal="true">
  <div class="splash-card">
    <img src="OIP.jpeg" alt="TASK logo" class="logo" onerror="this.style.display='none'">
    <h2 style="margin:6px 0 12px">TASK Employment Assistant</h2>
    <p style="margin:0 0 16px;opacity:.95">
      Focused on <b>getting ready for work</b>, <b>finding work</b>, and <b>keeping work</b> ‚Äî with direct links to TASK resources.
    </p>
    <button id="startBtn" class="splash-btn">Start</button>
  </div>
</div>

<!-- App -->
<main class="container" id="app" style="display:none">
  <header>
    <h1>Employment Assistant</h1>
    <div class="header-right">
      <button id="resetBtn" class="icon-btn" title="Clear chat" aria-label="Clear chat">‚Ü∫</button>
    </div>
  </header>

  <section id="chat" class="chat" role="log" aria-live="polite" aria-relevant="additions"></section>

  <!-- Input -->
  <div class="input-wrap">
    <div class="input-row">
      <button id="sparkleBtn" class="sparkle-btn" title="Suggestions" aria-label="Suggestions">‚ú¶</button>
      <input id="box" type="text" placeholder="Type your message..." autocomplete="off" aria-label="Message to assistant" />
      <button id="sendBtn" class="send-btn" aria-label="Send">
        <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true"><path d="M2 21l20-9L2 3l3 7 9 2-9 2-3 7z" fill="currentColor"/></svg>
      </button>
    </div>
    <div id="statusLine" class="status-line" role="status">‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info.</div>
  </div>

  <div class="legal">
    Disclaimer: This assistant is for informational purposes only and is not legal, financial, or employment advice.
  </div>
</main>

<script>
/* ========= CONFIG ========= */
const API_BASE = 'https://YOUR_WORKER_URL_HERE'; // <-- e.g. https://my-task-proxy.username.workers.dev

/* ========= TASK LINKS ========= */
const TASK = {
  address: "72 Escher St, Trenton, NJ 08609",
  site: "https://trentonsoupkitchen.org/",
  employment: "https://trentonsoupkitchen.org/job-search-and-assistance/",
  getHelpEmployment: "https://trentonsoupkitchen.org/get-help/#job-search-employment-services",
  arts: "https://trentonsoupkitchen.org/creative-arts-program/",
  bycell: [
    "https://bycell.co/ddmnx","https://bycell.co/ddmui","https://bycell.co/ddmua","https://bycell.co/ddmwm",
    "https://bycell.co/ddmul","https://bycell.co/ddmtq","https://bycell.co/ddncs","https://bycell.co/ddmtn",
  ],
  phones: { employment1: "609-697-6215", employment2: "609-697-6166", appointments: "609-337-1624" }
};

/* ========= DOM ========= */
const splash = document.getElementById('splash');
const startBtn = document.getElementById('startBtn');
const app = document.getElementById('app');
const chat = document.getElementById('chat');
const box = document.getElementById('box');
const sendBtn = document.getElementById('sendBtn');
const resetBtn = document.getElementById('resetBtn');
const statusLine = document.getElementById('statusLine');
const sparkleBtn = document.getElementById('sparkleBtn');

/* ========= Helpers ========= */
function openLink(u){ try{ window.open(u,'_blank','noopener'); }catch(e){} }
function callNumber(n){ window.location.href = 'tel:'+n.replace(/[^\d+]/g,''); }
function escapeHTML(s){ return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"); }
function scrollBottom(){ requestAnimationFrame(()=>{ chat.scrollTop = chat.scrollHeight; }); }

function addUser(text){
  const row = document.createElement('div');
  row.className = 'row user';
  row.innerHTML = `<div class="bubble">${escapeHTML(text)}</div>`;
  chat.appendChild(row); scrollBottom();
}
function addBot(html){
  const row = document.createElement('div');
  row.className = 'row bot';
  row.innerHTML = `<div class="avatar" aria-hidden="true">E</div><div class="bubble">${html}</div>`;
  chat.appendChild(row); scrollBottom();
}
function bulletize(text){
  const lines = String(text).split(/\r?\n/);
  const has = lines.some(l => /^\s*[\*\-]\s+/.test(l));
  if (!has) return escapeHTML(text).replace(/\n{2,}/g,'<br><br>').replace(/\n/g,'<br>');
  const items = lines.filter(l=>/^\s*[\*\-]\s+/.test(l)).map(l=>l.replace(/^\s*[\*\-]\s+/, '')).map(escapeHTML).map(x=>`<li>${x}</li>`).join('');
  return `<ul>${items}</ul>`;
}

/* ========= Suggestions ========= */
const SUGGESTIONS = [
  "Find warehouse jobs in Mercer County",
  "Draft a resume summary for entry-level retail",
  "Practice interview questions for Amazon",
  "Call TASK Employment Services",
  "Plan a bus route to TASK",
  "Explain PTO, FMLA, 401(k) simply",
];

/* ========= First screen & quick actions ========= */
function greet(){
  addBot(`
    <div class="quick-card">
      <strong>Welcome to TASK Employment Assistant</strong><br>
      I can connect you to TASK, plan bus routes, and point you to official job pages.
      <div class="quick-grid" style="margin-top:10px">
        <button class="qbtn" onclick="callNumber('${TASK.phones.employment1}')">üìû Employment Services<br><small>${TASK.phones.employment1}</small></button>
        <button class="qbtn" onclick="callNumber('${TASK.phones.employment2}')">üìû Training<br><small>${TASK.phones.employment2}</small></button>
        <button class="qbtn" onclick="callNumber('${TASK.phones.appointments}')">üìÖ Make Appointment<br><small>${TASK.phones.appointments}</small></button>
        <button class="qbtn" onclick="openLink('${TASK.employment}')">üß≠ Job Search & Assistance</button>
        <button class="qbtn" onclick="openLink('${TASK.site}')">üè† TASK Website</button>
        <button class="qbtn" onclick="openLink('${TASK.arts}')">üé® Creative Arts</button>
        <button class="qbtn" onclick="${TASK.bycell.map(u=>`openLink('${u}')`).join(';')}">üì≤ TASK Mobile Menus</button>
      </div>
      <small style="display:block;margin-top:8px;color:#a7bad5">Address: ${TASK.address}</small>
    </div>
  `);

  addBot(`Try one of these:<ul>${SUGGESTIONS.map(s=>`<li>${escapeHTML(s)}</li>`).join('')}</ul>`);
}

/* ========= AI ========= */
async function askAI(promptText){
  const ctrl = new AbortController();
  const t = setTimeout(()=>ctrl.abort('timeout'), 20000);
  try{
    const r = await fetch(API_BASE + '/ai', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ message: promptText }),
      signal: ctrl.signal
    });
    clearTimeout(t);
    if (!r.ok) {
      const detail = await r.text().catch(()=> '');
      throw new Error(detail);
    }
    const data = await r.json();
    return data?.text || 'No reply.';
  } catch (err) {
    clearTimeout(t);
    throw err;
  }
}

async function send(){
  const text = (box.value||'').trim();
  if (!text) return;

  addUser(text);
  box.value=''; box.focus();
  statusLine.textContent = 'Thinking‚Ä¶';

  try{
    const reply = await askAI(text);
    statusLine.textContent = 'Ready';
    addBot(bulletize(reply));
  } catch(err){
    statusLine.textContent = 'Network or API error.';
    addBot('Sorry ‚Äî I could not reach the AI right now.');
    console.error(err);
  }
}

/* ========= Events ========= */
sendBtn.addEventListener('click', send);
box.addEventListener('keydown', e => { if (e.key === 'Enter'){ e.preventDefault(); send(); }});
resetBtn.addEventListener('click', () => { chat.innerHTML=''; greet(); });
sparkleBtn.addEventListener('click', () => { box.value = SUGGESTIONS[Math.floor(Math.random()*SUGGESTIONS.length)]; box.focus(); });

startBtn.addEventListener('click', () => {
  splash.style.display = 'none';
  app.style.display = 'flex';
  greet();
  box.focus();
});
</script>
</body>
</html>
