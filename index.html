<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TASK Assistant</title>

  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"/>

  <style>
    :root{
      /* LIGHT */
      --bg: #f0f6fb;
      --panel: #ffffff;
      --ink: #143548;
      --muted: #6b6b6b;
      --ring: #0085CA;
      --accent: #ff911f;
      --accent-2: #ffc91f;
      --rail: #f7fbff;
      --chip: #145078;

      --success: #74ba58;
      --shadow: 0 20px 40px rgba(20,80,120,.30);
    }
    [data-theme="dark"]{
      /* DARK */
      --bg: #0e1a22;
      --panel: #0f202a;
      --ink: #e8f1f6;
      --muted: #9db0bd;
      --ring: #33A7B5;
      --accent: #ff9a33;
      --accent-2: #ffd25a;
      --rail: #0c1a22;
      --chip: #89c3ff;

      --success: #79d76e;
      --shadow: 0 16px 30px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Open Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: linear-gradient(135deg, #145078 0%, #33A7B5 100%), var(--bg);
      min-height:100vh;
      display:flex;align-items:center;justify-content:center;
      padding:14px;color:var(--ink);
    }

    .app{
      position:relative;
      width:100%;max-width:420px;background:var(--panel);
      border:3px solid var(--accent);border-radius:18px;overflow:hidden;
      box-shadow:var(--shadow);
    }

    .header{
      position:relative;
      text-align:center;background:var(--panel);
      border-bottom:2px solid var(--chip);
      padding:12px 48px 12px 12px;
    }
    .badge{
      display:inline-block;background:var(--chip);color:#fff;
      padding:6px 12px;border-radius:999px;font:700 13px/1 "Nunito",sans-serif;letter-spacing:.2px;
    }
    .subline{
      margin-top:6px;color:var(--accent);font:700 12px/1 "Nunito",sans-serif;
    }
    .theme-toggle{
      position:absolute;right:10px;top:10px;
      width:36px;height:36px;border-radius:50%;
      border:2px solid var(--accent);background:linear-gradient(135deg,var(--accent),var(--accent-2));
      color:#fff;font-weight:700;cursor:pointer;
    }

    .rail{
      display:flex;gap:10px;flex-wrap:wrap;justify-content:center;
      padding:10px 12px;background:var(--rail);border-bottom:1px solid rgba(0,0,0,.08);
    }
    .rail a{
      font-weight:600;text-decoration:none;color:var(--ink);
      border:1px solid var(--accent);background:transparent;border-radius:999px;
      padding:6px 10px;font-size:12px;
    }
    .rail a:hover{background:var(--accent);color:#fff}

    .chat{height:360px;overflow:auto;background:#fafafa14;padding:14px;scroll-behavior:smooth}

    .msg{margin:12px 0;padding:12px 16px;border-radius:16px;font-size:13px;line-height:1.45;animation:fade-in .16s ease}
    .user{margin-left:20%;text-align:right;color:#fff;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));border-radius:16px 16px 4px 16px;
      box-shadow:0 4px 12px rgba(255,145,31,.28);
    }
    .bot{margin-right:20%;background:var(--panel);border:2px solid var(--ring);
      color:var(--ink);border-radius:16px 16px 16px 4px;box-shadow:0 3px 10px rgba(0,133,202,.12);
    }
    .typing{display:flex;align-items:center;gap:6px;background:#e8edf2; color:#31485a; border:0}
    [data-theme="dark"] .typing{background:#17313f;color:#9db0bd}
    .dot{width:6px;height:6px;border-radius:50%;background:currentColor;animation:bob 1.2s infinite}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}

    .chips{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .chip{
      display:inline-block;border:1px solid var(--accent);border-radius:999px;
      padding:5px 10px;font-size:12px;text-decoration:none;color:var(--ink);
      background:transparent;
    }
    .chip:hover{background:var(--accent);color:#fff}

    .footer{padding:12px;background:#fafafa14;border-top:2px solid var(--ring)}
    .hint{font-size:11px;color:var(--ink);background:linear-gradient(135deg,rgba(116,186,88,.12),rgba(51,167,181,.12));
      border:2px solid var(--success);border-radius:12px;padding:8px 10px;text-align:center;font-weight:600;margin-bottom:10px}
    .inputrow{display:flex;gap:10px;align-items:center}
    input[type="text"]{
      flex:1;padding:14px 16px;border:2px solid var(--ring);border-radius:25px;font-size:13px;outline:none;background:var(--panel);color:var(--ink);
    }
    input[type="text"]:focus{border-color:var(--accent)}
    button.send{
      width:50px;height:50px;border:none;border-radius:50%;cursor:pointer;color:#fff;font-size:18px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 4px 15px rgba(255,145,31,.28);
    }
    .status{margin-top:6px;text-align:center;font-size:10px;color:var(--muted)}

    @keyframes fade-in{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
    @keyframes bob{0%,60%,100{transform:translateY(0)}30%{transform:translateY(-8px)}}
  </style>
</head>
<body>
  <main class="app" id="app" data-theme="light">
    <div class="header">
      <button id="themeToggle" class="theme-toggle" title="Toggle theme">â˜€</button>
      <div class="badge">TASK Assistant</div>
      <div class="subline">Trenton Area Soup Kitchen</div>
    </div>

    <!-- Pills row -->
    <nav class="rail" id="top-rail">
      <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">ğŸ“ Address</a>
      <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">ğŸ’¼ Jobs</a>
      <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">ğŸ”” Alerts</a>
      <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">ğŸ“ Training</a>
      <a href="https://bycell.co/ddmui" target="_blank" rel="noopener">ğŸ“„ Resume</a>
      <a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">ğŸ¥ Interview Tips</a>
      <a href="https://bycell.co/ddmua" target="_blank" rel="noopener">ğŸ§° Resources</a>
    </nav>

    <section class="chat" id="chat"></section>

    <footer class="footer">
      <div class="hint" id="langHint">I speak English, EspaÃ±ol & KreyÃ²l</div>
      <div class="inputrow">
        <input id="box" type="text" placeholder="Type: training, jobs, hours, address, busâ€¦" autocomplete="off"/>
        <button class="send" id="send" aria-label="Send">â¤</button>
      </div>
      <div class="status" id="status">âš ï¸ I can make mistakes â€” please double-check important info!</div>
    </footer>
  </main>
  <script>
    /* ---------- State ---------- */
    const chat = document.getElementById('chat');
    const box  = document.getElementById('box');
    const sendBtn = document.getElementById('send');
    const statusEl = document.getElementById('status');
    const themeToggle = document.getElementById('themeToggle');
    const appEl = document.getElementById('app');
    const langHint = document.getElementById('langHint');

    let BUSY = false;
    let currentLang = 'en';                  // always start in English
    const lastVariantIndex = {};             // avoid repeating variants per intent
    const LAST_REPLY_KEY = 'task_theme';

    /* ---------- Theme ---------- */
    function setTheme(mode){
      appEl.setAttribute('data-theme', mode);
      themeToggle.textContent = mode === 'dark' ? 'ğŸŒ™' : 'â˜€';
      localStorage.setItem(LAST_REPLY_KEY, mode);
    }
    setTheme(localStorage.getItem(LAST_REPLY_KEY) || 'light');
    themeToggle.addEventListener('click', ()=>{
      setTheme(appEl.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    });

    /* ---------- UI helpers ---------- */
    function addUser(text){
      const el = document.createElement('div');
      el.className = 'msg user';
      el.textContent = text;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    }
    function addBot(html){
      const el = document.createElement('div');
      el.className = 'msg bot';
      el.innerHTML = html;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    }
    function typingOn(){
      const wrap = document.createElement('div');
      wrap.className = 'msg typing';
      wrap.id = 'typing';
      wrap.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      chat.appendChild(wrap); chat.scrollTop = chat.scrollHeight;
    }
    function typingOff(){
      const t = document.getElementById('typing'); if (t) t.remove();
    }

    /* ---------- Language packs ---------- */
    const L = {
      en:{
        greet:`ğŸ‘‹ Hello! Tell me <em>training</em>, <em>jobs</em>, <em>hours</em>, <em>address</em>, or <em>bus</em>.<br><br>
               <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Training</a> â€¢
               <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Jobs</a> â€¢
               <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alerts</a>`,
        hint:`I speak English, EspaÃ±ol & KreyÃ²l`,
        call:`Call Social Services Specialist at <a href="tel:609-337-1624">(609) 337-1624</a>. During lunch (10:30 AMâ€“1:00 PM).`,
        hours:`Meals: Lunch Monâ€“Fri 10:30aâ€“1:00p â€¢ Dinner Monâ€“Thu 3:30â€“5:00p<br>Employment appointments are scheduled during lunch (10:30 AMâ€“1:00 PM).`,
        location:`72Â½ Escher St, Trenton, NJ 08609<br><a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">Open Google Maps</a>`,
        transit:`<a href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">NJ Transit Trip Planner</a> â€¢ 1-973-275-5555<br>Destination: 72Â½ Escher St, Trenton`,
        resources:`<a href="https://bycell.co/ddmua" target="_blank" rel="noopener">Additional resources</a><br><a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank" rel="noopener">Full TASK services</a>`,
        resume:`<a href="https://bycell.co/ddmui" target="_blank" rel="noopener">Resume help & templates</a>`,
        interview:`<a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">Watch quick interview tips</a>`,
        jobsLink:`<a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Open positions</a>`,
        alertsLink:`<a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Job alerts</a>`
      },
      es:{
        greet:`ğŸ‘‹ Â¡Hola! Soy el Asistente de TASK. PregÃºntame sobre <em>entrenamientos</em>, <em>empleos</em>, <em>horarios</em>, <em>direcciÃ³n</em> o <em>autobÃºs</em>.<br><br>
               <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Entrenamientos</a> â€¢
               <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Empleos</a> â€¢
               <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alertas</a>`,
        hint:`Hablo inglÃ©s y espaÃ±ol (y KreyÃ²l)`,
        call:`Llama al Especialista de Servicios Sociales al <a href="tel:609-337-1624">(609) 337-1624</a>. Durante el almuerzo (10:30 AMâ€“1:00 PM).`,
        hours:`Comidas: Almuerzo Lunâ€“Vie 10:30â€“1:00 â€¢ Cena Lunâ€“Jue 3:30â€“5:00<br>Las citas de empleo se programan durante el almuerzo (10:30 AMâ€“1:00 PM).`,
        location:`72Â½ Escher St, Trenton, NJ 08609<br><a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">Abrir Google Maps</a>`,
        transit:`<a href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">Planificador de viajes NJ Transit</a> â€¢ 1-973-275-5555<br>Destino: 72Â½ Escher St, Trenton`,
        resources:`<a href="https://bycell.co/ddmua" target="_blank" rel="noopener">Recursos adicionales</a><br><a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank" rel="noopener">Servicios completos de TASK</a>`,
        resume:`<a href="https://bycell.co/ddmui" target="_blank" rel="noopener">Ayuda con currÃ­culum y plantillas</a>`,
        interview:`<a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">Consejos rÃ¡pidos de entrevista</a>`,
        jobsLink:`<a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Puestos disponibles</a>`,
        alertsLink:`<a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alertas de empleo</a>`
      },
      ht:{
        greet:`ğŸ‘‹ Bonjou! M ap ede w ak <em>fÃ²masyon</em>, <em>travay</em>, <em>lÃ¨ yo</em>, <em>adrÃ¨s</em> oswa <em>otobis</em>.<br><br>
               <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">FÃ²masyon</a> â€¢
               <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Travay</a> â€¢
               <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">AlÃ¨t</a>`,
        hint:`M pale anglÃ¨, espayÃ²l & kreyÃ²l`,
        call:`Rele Espesyalis SÃ¨vis Sosyal la: <a href="tel:609-337-1624">(609) 337-1624</a>. Pandan manje midi (10:30 AMâ€“1:00 PM).`,
        hours:`Manje: Midi Lenâ€“Van 10:30â€“1:00 â€¢ AswÃ¨ Lenâ€“Jed 3:30â€“5:00<br>Randevou travay yo fÃ¨t pandan manje midi (10:30 AMâ€“1:00 PM).`,
        location:`72Â½ Escher St, Trenton, NJ 08609<br><a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">Louvri Google Maps</a>`,
        transit:`<a href="https://www.njtransit.com/trip-planner-to" target="_blank" rel="noopener">Planifye vwayaj NJ Transit</a> â€¢ 1-973-275-5555<br>Destinasyon: 72Â½ Escher St, Trenton`,
        resources:`<a href="https://bycell.co/ddmua" target="_blank" rel="noopener">Resous anplis</a><br><a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank" rel="noopener">Tout sÃ¨vis TASK yo</a>`,
        resume:`<a href="https://bycell.co/ddmui" target="_blank" rel="noopener">Ede ak CV & modÃ¨l yo</a>`,
        interview:`<a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">KonsÃ¨y entÃ¨vyou rapid</a>`,
        jobsLink:`<a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Of job yo</a>`,
        alertsLink:`<a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">AlÃ¨t Travay</a>`
      }
    };
    /* ---------- Language detection & switching ---------- */
    function detectLang(text){
      const t = text.toLowerCase();
      const es = /(?:\b|[Â¿Â¡])(hola|necesito|trabajo|empleo|d[oÃ³]nde|cu[aÃ¡]ndo|hora|horas|espa[nÃ±]ol|tel[eÃ©]fono|direcci[oÃ³]n|cita|servicios|comida)\b/.test(t);
      const ht = /\b(bonjou|bonswa|mwen|bezwen|travay|kote|ede|manje|krey[oÃ²]l|telef[oÃ²]n|adr[eÃ¨]s|randevou|s[eÃ¨]vis)\b/.test(t);
      const askEs = /(espanol|espaÃ±ol|en\s*espaÃ±ol)/.test(t);
      const askHt = /(krey[oÃ²]l|creole|an\s*krey[oÃ²]l)/.test(t);
      const askEn = /\benglish|in english|eng\b/i.test(text);

      if (askEn) return 'en';
      if (askEs || es) return 'es';
      if (askHt || ht) return 'ht';
      return currentLang; // keep previous unless clearly different
    }

    /* ---------- Intent patterns ---------- */
    const INTENTS = {
      trainings: /(training|trainings|program|programs|class|classes|course|courses|certification|culinary|emilio|academy|sora|forklift|apprenticeship|skills|upskilling|kitchen\s*class)\b/,
      jobs: /(job|jobs|work|employment|hiring|hire|opening|openings|apply|application|position|positions|career|careers|warehouse|security|cook|chef)\b|empleo|trabajo|travay/,
      alerts: /(alert|alerts|notify|notification|subscribe|updates|text\s*me\s*jobs)/,
      resume: /(resume|curriculum|currÃ­culum|cv|cover\s*letter|resumÃ©)/,
      interview: /(interview|mock\s*interview|practice\s*interview|interview\s*tips|behavioral)/,
      appointments: /(appointment|schedule|book|meeting|see\s*someone|come\s*in|cita|programar|randevou)/,
      hours: /(hour|hours|time|when|open|close|lunch|dinner|meal|eat|food|hora|almuerzo|cena|manje|meals)/,
      location: /(where|address|location|directions|map|parking|d[oÃ³]nde|direcci[oÃ³]n|ubicaci[oÃ³]n|kote|adr[eÃ¨]s|google\s*maps|how\s*do\s*i\s*get\s*there)/,
      transit: /(bus|nj\s*transit|route|fare|ticket|train|transport|planner|600\b.*bus|bus\b.*600)/,
      computer_lab: /(computer|internet|wifi|lab|email|application\s*online|print|printing)/,
      // route legal/benefits/housing/ID to resources
      resources: /(resource|resources|assistance|support\s*services|services\s*list|legal|immigration|asylum|citizenship|housing|shelter|id\s*card|identification|benefits|veterans|domestic\s*violence|dv)/,
      greeting: /^( *hi| *hello| *hey| *hola| *bonjou)[!. ]*$/i,
      thanks: /(thanks|thank you|gracias|mesi)/
    };

    function findIntents(text){
      const t = (' '+text.toLowerCase()+' ').replace(/[^\p{L}\p{N}\s]/gu,' ');
      const order = ['trainings','jobs','appointments','hours','location','transit','resume','interview','alerts','computer_lab','resources','greeting','thanks'];
      const hits = [];
      for (const k of order){
        if (INTENTS[k] && INTENTS[k].test(t)) hits.push(k);
        if (hits.length === 2) break;                 // answer max 2 topics
      }
      if (!hits.length) hits.push('default');
      return hits;
    }

    /* ---------- Variant templates (non-repeating) ---------- */
    function pickVariant(intent, arr){
      const last = lastVariantIndex[intent] ?? -1;
      let idx = Math.floor(Math.random()*arr.length);
      if (arr.length > 1 && idx === last) idx = (idx + 1) % arr.length;
      lastVariantIndex[intent] = idx;
      return arr[idx];
    }

    function responseFor(intent, lang){
      const t = L[lang];

      const variants = {
        trainings: [
          `<strong>ğŸ“ Training programs</strong><br>Emilio Culinary (10-weeks), SORA Security, Forklift, soft-skills. <br>${t.call}<div class="chips"><a class="chip" href="https://bycell.co/ddmtn" target="_blank">Browse training</a><a class="chip" href="https://bycell.co/ddmtq" target="_blank">Open jobs</a></div>`,
          `<strong>ğŸ“ Interested in courses?</strong><br>We offer Culinary, SORA and Forklift. <br>${t.call}<div class="chips"><a class="chip" href="https://bycell.co/ddmtn" target="_blank">See programs</a><a class="chip" href="https://bycell.co/ddmui" target="_blank">Resume help</a></div>`
        ],
        jobs: [
          `<strong>ğŸ’¼ Jobs</strong><br>${t.jobsLink}<br>${t.alertsLink}<div class="chips"><a class="chip" href="https://bycell.co/ddmtn" target="_blank">Training</a><a class="chip" href="https://bycell.co/ddmui" target="_blank">Resume</a></div>`,
          `<strong>ğŸ’¼ Looking for work?</strong><br>${t.jobsLink} â€¢ ${t.alertsLink}<div class="chips"><a class="chip" href="https://bycell.co/ddmtn" target="_blank">Culinary / SORA</a></div>`
        ],
        alerts: [
          `<strong>ğŸ”” Job alerts</strong><br>${t.alertsLink}`,
          `<strong>ğŸ”” Get notified</strong><br>${t.alertsLink}`
        ],
        resume: [
          `<strong>ğŸ“„ Resume help</strong><br>${t.resume}`,
          `<strong>ğŸ“„ Need a resume?</strong><br>${t.resume}`
        ],
        interview: [
          `<strong>ğŸ¥ Interview tips</strong><br>${t.interview}`,
          `<strong>ğŸ¥ Practice interviews</strong><br>${t.interview}`
        ],
        appointments: [
          `<strong>ğŸ“… Appointments</strong><br>${t.call}`,                    // no â€œregister onlineâ€
          `<strong>ğŸ“… Want to meet?</strong><br>${t.call}`
        ],
        hours: [
          `<strong>ğŸ•’ Hours</strong><br>${t.hours}`,
          `<strong>ğŸ•’ Meal & service hours</strong><br>${t.hours}`
        ],
        location: [
          `<strong>ğŸ“ Location</strong><br>${t.location}<div class="chips"><a class="chip" href="https://www.njtransit.com/trip-planner-to" target="_blank">Bus to TASK</a></div>`,
          `<strong>ğŸ“ How to find us</strong><br>${t.location}`
        ],
        transit: [
          `<strong>ğŸšŒ Transit</strong><br>${t.transit}`,
          `<strong>ğŸšŒ Getting here</strong><br>${t.transit}`
        ],
        computer_lab: [
          `<strong>ğŸ’» Computer lab</strong><br>Open during meal hours. Free internet & job applications.`,
          `<strong>ğŸ’» Computers/Wi-Fi</strong><br>Use our lab during meal hours. We can help with applications.`
        ],
        resources: [
          `<strong>ğŸ§° Resources</strong><br>${t.resources}`,
          `<strong>ğŸ§° Need legal / housing / benefits?</strong><br>${t.resources}`
        ],
        greeting: [
          t.greet
        ],
        thanks: [
          `ğŸ˜Š Youâ€™re welcome!`,
          `ğŸ‘ Glad to help!`
        ],
        default: [
          `Iâ€™ll keep it simple. Try â€œtrainingâ€, â€œjobsâ€, â€œappointmentâ€, â€œhoursâ€, â€œaddressâ€, or â€œbusâ€.<div class="chips"><a class="chip" href="https://bycell.co/ddmtn" target="_blank">Training</a><a class="chip" href="https://bycell.co/ddmtq" target="_blank">Jobs</a></div>`
        ]
      };

      return pickVariant(intent, variants[intent]);
    }

    /* ---------- Router ---------- */
    function routeAndReply(text){
      // Switch language early
      const newLang = detectLang(text);
      if (newLang !== currentLang){
        currentLang = newLang;
        langHint.textContent = L[currentLang].hint;
      }

      const intents = findIntents(text);
      intents.slice(0,2).forEach(intent => addBot(responseFor(intent, currentLang)));
    }
    /* ---------- Send & wire ---------- */
    function sendMessage(){
      if (BUSY) return;
      const text = (box.value || '').trim();
      if (!text) return;

      BUSY = true;
      addUser(text);
      box.value = '';
      statusEl.textContent = 'ğŸ¤– Thinkingâ€¦';
      typingOn();

      setTimeout(()=>{
        typingOff();
        routeAndReply(text);
        statusEl.textContent = 'âœ… Answered!';
        setTimeout(()=> statusEl.textContent = 'âš ï¸ I can make mistakes â€” please double-check important info!', 1200);
        BUSY = false;
        box.focus();
      }, 260);
    }

    sendBtn.addEventListener('click', sendMessage);
    box.addEventListener('keydown', e=>{
      if (e.key === 'Enter'){ e.preventDefault(); sendMessage(); }
    });

    // Initial greeting in English (always)
    addBot(L.en.greet);
  </script>
</body>
</html>
