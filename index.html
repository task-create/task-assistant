<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TASK Assistant</title>

  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --task-blue:#145078;
      --task-teal:#33A7B5;
      --task-orange:#ff911f;
      --task-yellow:#ffc91f;
      --task-green:#74ba58;
      --task-blue-accent:#0085CA;
      --gray-700:#6b6b6b;
      --gray-200:#e9eef3;

      /* Optional watermark logo (PNG/SVG). Turn on in JS with data-logo="on" */
      --logo-url:'';
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Open Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(135deg,var(--task-blue) 0%,var(--task-teal) 100%);
      min-height:100vh;display:flex;align-items:center;justify-content:center;padding:14px;
    }
    .app{
      position:relative;width:100%;max-width:420px;background:#fff;
      border:3px solid var(--task-orange);border-radius:18px;overflow:hidden;
      box-shadow:0 20px 40px rgba(20,80,120,.30);
    }
    /* watermark */
    .app::before{
      content:"";position:absolute;inset:0;pointer-events:none;opacity:.06;
      background:radial-gradient(ellipse at center, #fff 0%, #fff 40%, transparent 60%) center/75% 75% no-repeat;
      mix-blend-mode:normal;
    }
    .app[data-logo="on"]::before{ background: url(var(--logo-url)) center/70% no-repeat; opacity:.05; }

    .header{ text-align:center;background:#fff;border-bottom:2px solid var(--task-blue);padding:12px 12px 10px; }
    .badge{ display:inline-block;background:var(--task-blue);color:#fff;padding:6px 12px;border-radius:999px;
            font:700 13px/1 "Nunito",sans-serif;letter-spacing:.2px; }
    .subline{ margin-top:6px;color:var(--task-orange);font:700 12px/1 "Nunito",sans-serif; }

    .rail{ display:flex;gap:12px;flex-wrap:wrap;justify-content:center;
           padding:10px 12px;background:#f7fbff;border-bottom:1px solid var(--gray-200);}
    .rail a{ font-weight:600;text-decoration:none;color:var(--task-blue);
             border:1px solid var(--task-orange);background:#fff;border-radius:999px;
             padding:6px 10px;font-size:12px; }
    .rail a:hover{ background:var(--task-orange);color:#fff }

    .chat{height:360px;overflow:auto;background:#fafafa;padding:14px;scroll-behavior:smooth}

    .msg{margin:12px 0;padding:12px 16px;border-radius:16px;font-size:13px;line-height:1.45;animation:fade-in .16s ease}
    .user{margin-left:20%;text-align:right;color:#fff;
      background:linear-gradient(135deg,var(--task-orange),var(--task-yellow));border-radius:16px 16px 4px 16px;
      box-shadow:0 4px 12px rgba(255,145,31,.28);
    }
    .bot{margin-right:20%;background:#fff;border:2px solid var(--task-blue-accent);
      color:#333;border-radius:16px 16px 16px 4px;box-shadow:0 3px 10px rgba(0,133,202,.12);
    }
    .typing{display:flex;align-items:center;gap:6px;background:#e8edf2;color:#4b5a69}
    .dot{width:6px;height:6px;border-radius:50%;background:#4b5a69;animation:bob 1.2s infinite}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}

    .footer{padding:12px;background:#fafafa;border-top:2px solid var(--task-blue-accent)}
    .hint{font-size:11px;color:var(--task-blue);background:linear-gradient(135deg,rgba(116,186,88,.1),rgba(51,167,181,.1));
      border:2px solid var(--task-green);border-radius:12px;padding:8px 10px;text-align:center;font-weight:600;margin-bottom:10px}
    .inputrow{display:flex;gap:10px;align-items:center}
    input[type="text"]{
      flex:1;padding:14px 16px;border:2px solid var(--task-blue-accent);border-radius:25px;font-size:13px;outline:none;background:#fff;
    }
    input[type="text"]:focus{border-color:var(--task-orange)}
    button.send{
      width:50px;height:50px;border:none;border-radius:50%;cursor:pointer;color:#fff;font-size:18px;
      background:linear-gradient(135deg,var(--task-orange),var(--task-yellow));box-shadow:0 4px 15px rgba(255,145,31,.28);
    }
    .status{margin-top:6px;text-align:center;font-size:10px;color:#6b6b6b}

    .ctas{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .ctas a{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--task-orange);text-decoration:none;
            color:var(--task-blue);font-weight:600;font-size:12px;background:#fff}
    .ctas a:hover{background:var(--task-orange);color:#fff}

    @keyframes fade-in{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
    @keyframes bob{0%,60%,100{transform:translateY(0)}30%{transform:translateY(-8px)}}

    @media (max-width:480px){ .app{border-radius:16px}}
  </style>
</head>
<body>
  <main class="app" id="app">
    <div class="header">
      <div class="badge">TASK Assistant</div>
      <div class="subline">Trenton Area Soup Kitchen</div>
    </div>

    <!-- Quick links rail (always open in a new tab; no chat side-effects) -->
    <nav class="rail" id="top-rail">
      <a href="https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609" target="_blank" rel="noopener">üìç Address</a>
      <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">üíº Jobs</a>
      <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">üîî Alerts</a>
      <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">üéì Training</a>
      <a href="https://bycell.co/ddmui" target="_blank" rel="noopener">üìÑ Resume</a>
      <a href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank" rel="noopener">üé• Interview Tips</a>
      <a href="https://bycell.co/ddmua" target="_blank" rel="noopener">üß∞ Resources</a>
    </nav>

    <section class="chat" id="chat"></section>

    <footer class="footer">
      <div class="hint" id="hint">I speak English, Espa√±ol & Krey√≤l</div>
      <div class="inputrow">
        <input id="box" type="text" placeholder="Type: training, jobs, hours, address, bus‚Ä¶" autocomplete="off"/>
        <button class="send" id="send" aria-label="Send">‚û§</button>
      </div>
      <div class="status" id="status">‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info!</div>
    </footer>
  </main>

  <script>
    // Optional watermark logo: set --logo-url in :root and uncomment:
    // document.getElementById('app').setAttribute('data-logo', 'on');

    const chat    = document.getElementById('chat');
    const box     = document.getElementById('box');
    const sendBtn = document.getElementById('send');
    const statusEl= document.getElementById('status');
    const hintEl  = document.getElementById('hint');

    // --- i18n -----------------------------------------------------------------
    const i18n = {
      en: {
        hint: 'I speak English, Espa√±ol & Krey√≤l',
        greet: `üëã Hi! I'm the TASK Assistant.<br>
                Ask me about <em>training</em>, <em>jobs</em>, <em>appointments</em>, <em>hours</em>,
                <em>address</em>, or <em>bus</em>.`,
        asked: 'You asked about',
        call: 'Call',
        during: 'During lunch (10:30 AM‚Äì1:00 PM)',
        phoneHtml: '<a href="tel:609-337-1624">(609) 337-1624</a>',
        workHub: 'Do you want open jobs or career help?',
        default: `Try ‚Äútraining‚Äù, ‚Äújobs‚Äù, ‚Äúappointment‚Äù, ‚Äúhours‚Äù, ‚Äúaddress‚Äù, or ‚Äúbus‚Äù.`,
        welcomeQuick: `Quick links: <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Training</a> ‚Ä¢
                       <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Jobs</a> ‚Ä¢
                       <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alerts</a>`
      },
      es: {
        hint: 'Hablo ingl√©s y espa√±ol (y Krey√≤l)',
        greet: `üëã ¬°Hola! Soy el Asistente de TASK.<br>
                Preg√∫ntame sobre <em>entrenamientos</em>, <em>empleos</em>, <em>citas</em>, <em>horarios</em>,
                <em>direcci√≥n</em>, o <em>autob√∫s</em>.`,
        asked: 'Me preguntas sobre',
        call: 'Llama',
        during: 'Durante el almuerzo (10:30 AM‚Äì1:00 PM)',
        phoneHtml: '<a href="tel:609-337-1624">(609) 337-1624</a>',
        workHub: '¬øDeseas ver vacantes o ayuda de carrera?',
        default: `Prueba ‚Äúentrenamientos‚Äù, ‚Äúempleos‚Äù, ‚Äúcita‚Äù, ‚Äúhorarios‚Äù, ‚Äúdirecci√≥n‚Äù o ‚Äúautob√∫s‚Äù.`,
        welcomeQuick: `Enlaces: <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">Entrenamientos</a> ‚Ä¢
                       <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Empleos</a> ‚Ä¢
                       <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Alertas</a>`
      },
      ht: {
        hint: 'M pale English, Espa√±ol & Krey√≤l',
        greet: `üëã Bonjou! Mwen se Asistan TASK la.<br>
                Mande m sou <em>f√≤masyon</em>, <em>travay</em>, <em>randevou</em>, <em>l√®</em>,
                <em>adr√®s</em>, oswa <em>otobis</em>.`,
        asked: 'W ap mande sou',
        call: 'Rele',
        during: 'L√® manje midi (10:30 AM‚Äì1:00 PM)',
        phoneHtml: '<a href="tel:609-337-1624">(609) 337-1624</a>',
        workHub: 'Ou vle w√® travay ki louvri oswa √®d ak kary√® a?',
        default: `Eseye ‚Äúf√≤masyon‚Äù, ‚Äútravay‚Äù, ‚Äúrandevou‚Äù, ‚Äúl√®‚Äù, ‚Äúadr√®s‚Äù, oswa ‚Äúotobis‚Äù.`,
        welcomeQuick: `Kout lyen: <a href="https://bycell.co/ddmtn" target="_blank" rel="noopener">F√≤masyon</a> ‚Ä¢
                       <a href="https://bycell.co/ddmtq" target="_blank" rel="noopener">Travay</a> ‚Ä¢
                       <a href="https://bycell.co/ddmtr" target="_blank" rel="noopener">Al√®t</a>`
      }
    };

    let LANG = (localStorage.getItem('task_lang')) ||
               (navigator.language||'en').slice(0,2).replace('es','es').replace('ht','ht');
    if (!['en','es','ht'].includes(LANG)) LANG = 'en';
    setUiLang(LANG);

    // --- helpers --------------------------------------------------------------
    function setUiLang(l){
      LANG = l;
      localStorage.setItem('task_lang', l);
      hintEl.textContent = i18n[l].hint;
      // update placeholder to match language tone
      if(l==='es') box.placeholder = 'Escribe: entrenamientos, empleos, horarios, direcci√≥n, autob√∫s‚Ä¶';
      else if(l==='ht') box.placeholder = 'Tape: f√≤masyon, travay, l√®, adr√®s, otobis‚Ä¶';
      else box.placeholder = 'Type: training, jobs, hours, address, bus‚Ä¶';
    }

    function addUser(text){
      const el = document.createElement('div');
      el.className = 'msg user';
      el.textContent = text;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    }
    function addBot(html){
      const el = document.createElement('div');
      el.className = 'msg bot';
      el.innerHTML = html;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    }
    function typingOn(){
      const wrap = document.createElement('div');
      wrap.className = 'msg typing'; wrap.id = 'typing';
      wrap.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      chat.appendChild(wrap); chat.scrollTop = chat.scrollHeight;
    }
    function typingOff(){ const t = document.getElementById('typing'); if (t) t.remove(); }

    // greet once
    addBot(`${i18n[LANG].greet}<br><br>${i18n[LANG].welcomeQuick}`);

    // --- language detection / switching --------------------------------------
    function detectLang(input){
      const t = input.toLowerCase();
      // Explicit switches
      if (/^\s*(english|ingl[e√©]s)\s*$/.test(t)) return 'en';
      if (/^\s*(espanol|espa√±ol|spanish)\s*$/.test(t)) return 'es';
      if (/^\s*(krey[o√≤]l|creole|kreyol)\s*$/.test(t)) return 'ht';

      // Heuristics
      const es = /hola|necesit|trabaj|emple|d[o√≥]nde|cu[a√°]ndo|hora|horas|autob[u√∫]s|gracias|cita|servici|comida|direcci[o√≥]n|tel[e√©]fono|curso|capacitaci[o√≥]n|entrenam/i.test(t);
      const ht = /bonjou|bonswa|mwen|bezwen|travay|kote|ede|manje|krey[o√≤]l|telef[o√≤]n|adr[e√®]s|randevou|s[e√®]vis|otobis/i.test(t);
      return es ? 'es' : (ht ? 'ht' : LANG);
    }

    // --- intent classification -----------------------------------------------
    function classifyIntent(text){
      const t = (' '+text.toLowerCase()+' ').replace(/[^\p{L}\p{N}\s]/gu,' ');
      const bag = {
        trainings: /(training|trainings|program|programs|class|classes|course|courses|certificate|certification|culinary|emilio|academy|sora|forklift|apprentice|curso|capacitaci[o√≥]n|form[a√†]syon)\b/,
        jobs: /(job|jobs|employment|hiring|opening|openings|apply|application|position|positions|indeed|empleo|trabajo|vacante|travay)\b/,
        alerts: /(alert|alerts|notify|notification|subscribe|updates|alerta|al[e√©]r|al√®t)\b/,
        resume: /(resume|curriculum|curr[i√≠]culum|cv|cover\s*letter|plantilla)\b/,
        interview: /(interview(\s*tips)?|mock\s*interview|practice\s*interview|entrevista|kons[e√®]y\s*ent[e√®]vyou)\b/,
        appointments: /(appointment|schedule|book|meeting|register|sign\s*up|cita|programar|randevou|enskri)\b/,
        hours: /(hour|hours|time|when|open|close|lunch|dinner|meal|eat|food|hora|horario|almuerzo|cena|manje|l[e√®])\b/,
        location: /(where|address|location|directions|map|parking|d[o√≥]nde|direcci[o√≥]n|ubicaci[o√≥]n|kote|adr[e√®]s)\b/,
        transit: /(bus|nj\s*transit|route|fare|ticket|train|transport|planner|otobis|autob[u√∫]s)\b/,
        computer_lab: /(computer|internet|wifi|lab|email|application\s*online|computadora|√≤dinat[e√®])\b/,
        resources: /(resource|resources|assistance|support\s*services|services\s*list|legal|immigration|lawyer|court|housing|rent|eviction|benefits|id\s*card|dv|violence|referral|ayuda|asistencia|legal|lojman|imigrasyon)\b/,
        work_hub: /^\s*(work|trabajo|travay)\s*$/, // ambiguous single word
        greeting: /^( *hi| *hello| *hey| *hola| *bonjou)[!. ]*$/i,
        thanks: /(thanks|thank you|gracias|mesi)\b/
      };
      for (const [k, rx] of Object.entries(bag)){ if (rx.test(t)) return k; }
      return 'default';
    }

    // --- response router ------------------------------------------------------
    function ctas(arr){
      // arr = [ [label, href], ... ]
      return `<div class="ctas">${arr.map(([l,h])=>`<a href="${h}" target="_blank" rel="noopener">${l}</a>`).join('')}</div>`;
    }

    function route(text){
      // language handling
      const newLang = detectLang(text);
      if (newLang !== LANG){ setUiLang(newLang); }

      const L = i18n[LANG];
      const phone = L.phoneHtml;
      const asked = L.asked;

      const intent = classifyIntent(text);

      const R = {
        trainings: () => (
          `<strong>üéì ${asked} training.</strong><br><br>
           ‚Ä¢ Emilio Culinary Academy (10-week)<br>
           ‚Ä¢ SORA Security Certification<br>
           ‚Ä¢ Forklift Certification<br><br>
           ${ctas([
              ['Browse Training & Apply','https://bycell.co/ddmtn'],
              ['Call Social Services','tel:6093371624']
            ])}
           ${L.call} the Social Services Specialist: ${phone}. ${L.during}.`
        ),
        jobs: () => (
          `<strong>üíº ${asked} jobs.</strong><br><br>
           ${ctas([
              ['Open Positions','https://bycell.co/ddmtq'],
              ['Get Job Alerts','https://bycell.co/ddmtr'],
              ['Resume Help','https://bycell.co/ddmui']
            ])}
           Need help applying? ${L.call}: ${phone}. ${L.during}.`
        ),
        alerts: () => (
          `<strong>üîî ${asked} job alerts.</strong><br><br>
           ${ctas([['Subscribe to Alerts','https://bycell.co/ddmtr']])}`
        ),
        resume: () => (
          `<strong>üìÑ ${asked} resume help.</strong><br><br>
           ${ctas([['Resume Help & Templates','https://bycell.co/ddmui']])}
           1-on-1 help? ${L.call}: ${phone}. ${L.during}.`
        ),
        interview: () => (
          `<strong>üé• ${asked} interview tips.</strong><br><br>
           ${ctas([['Watch quick tips','https://www.youtube.com/watch?v=ZU9x1vFx5lI']])}`
        ),
        appointments: () => (
          `<strong>üìÖ ${asked} an appointment.</strong><br><br>
           ${L.call} the Social Services Specialist at ${phone}. ${L.during}.<br>
           Or register online here: ${ctas([['Register','https://bycell.co/ddmul']])}`
        ),
        hours: () => (
          `<strong>üïí ${asked} hours.</strong><br><br>
           Meals:<br>
           ‚Ä¢ Lunch: Mon‚ÄìFri 10:30a‚Äì1:00p<br>
           ‚Ä¢ Dinner: Mon‚ÄìThu 3:30‚Äì5:00p<br><br>
           Employment appointments are scheduled ${L.during.toLowerCase()}.`
        ),
        location: () => (
          `<strong>üìç ${asked} our location.</strong><br><br>
           72¬Ω Escher St, Trenton, NJ 08609<br>
           ${ctas([['Open Google Maps','https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609']])}
           Appointments: ${phone}.`
        ),
        transit: () => (
          `<strong>üöå ${asked} transit.</strong><br><br>
           ${ctas([['NJ Transit Trip Planner','https://www.njtransit.com/trip-planner-to']])}
           Info line: 1-973-275-5555 ‚Ä¢ Destination: 72¬Ω Escher St, Trenton.`
        ),
        computer_lab: () => (
          `<strong>üíª ${asked} the computer lab.</strong><br><br>
           Open during meal hours. Free internet & help with online applications.`
        ),
        resources: () => (
          `<strong>üß∞ ${asked} resources.</strong><br><br>
           We can help connect with housing, IDs, benefits, **legal/immigration**, DV, and more.<br><br>
           ${ctas([
              ['Additional Resources','https://bycell.co/ddmua'],
              ['Full TASK Services','https://trentonsoupkitchen.org/what-we-do/'],
              ['Call Social Services','tel:6093371624']
           ])}`
        ),
        work_hub: () => (
          `<strong>üíº ${L.workHub}</strong>${ctas([
            ['Open Jobs','https://bycell.co/ddmtq'],
            ['Career Help & Training','https://bycell.co/ddmtn'],
            ['Resume Help','https://bycell.co/ddmui']
          ])}
          ${L.call}: ${phone}. ${L.during}.`
        ),
        greeting: () => (
          `${i18n[LANG].greet}<br><br>${i18n[LANG].welcomeQuick}`
        ),
        thanks: () => `üòä ${LANG==='es'?'¬°Con gusto!':LANG==='ht'?'Pa gen pwobl√®m!':'You‚Äôre welcome!'}`,
        default: () => (
          `${i18n[LANG].default}<br><br>${ctas([
            ['Training','https://bycell.co/ddmtn'],
            ['Jobs','https://bycell.co/ddmtq'],
            ['Address','https://www.google.com/maps?q=72+1/2+Escher+St,+Trenton,+NJ+08609']
          ])}`
        )
      };

      return (R[intent]||R.default)();
    }

    // --- main send loop -------------------------------------------------------
    let BUSY = false;

    function sendMessage(){
      if (BUSY) return;
      const text = (box.value||'').trim();
      if (!text) return;

      BUSY = true;
      addUser(text);
      box.value = '';
      statusEl.textContent = 'ü§ñ Thinking‚Ä¶';
      typingOn();

      setTimeout(()=>{
        typingOff();
        addBot(route(text));
        statusEl.textContent = '‚úÖ Answered!';
        setTimeout(()=> statusEl.textContent =
          (LANG==='es'?'‚ö†Ô∏è Puedo equivocarme ‚Äî verifique la informaci√≥n importante.':
           LANG==='ht'?'‚ö†Ô∏è Mwen ka f√® er√® ‚Äî tanpri tcheke enf√≤masyon enp√≤tan yo!':
                        '‚ö†Ô∏è I can make mistakes ‚Äî please double-check important info!'), 1200);
        BUSY = false;
        box.focus();
      }, 260);
    }

    sendBtn.addEventListener('click', sendMessage);
    box.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); sendMessage(); } });

    // Keep rail links ‚Äúpure‚Äù (no chat injection)
    document.getElementById('top-rail').addEventListener('click', e=>{
      const a = e.target.closest('a'); if(!a) return;
    });
  </script>
</body>
</html>
