<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>TASK Assistant</title>
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"/>
<meta name="theme-color" content="#ffffff">
<style>
:root{--radius:18px;--bg:#eef3f8;--surface:#fff;--surface-2:#f7fbff;--text:#0e1726;--muted:#5f6c80;--brand:#145078;--accent:#ff911f;--accent-2:#ffc91f;--border:#d9e2ec;--link:#0b63c6;--shadow:0 18px 36px rgba(20,80,120,.18);--shadow-soft:0 8px 20px rgba(19,33,58,.12);--bubble-bot:#fff;--bubble-border:#d9e2ec;--bubble-user-bg:linear-gradient(135deg,#ff911f,#ffc91f);--bubble-user-text:#fff;--bubble-user-border:transparent;--typing:#7e8aa3}
[data-theme="dark"]{--bg:#0b1220;--surface:#0f1726;--surface-2:#0d1522;--text:#e6edf7;--muted:#a7b6c9;--brand:#8bd0ff;--accent:#ffb357;--accent-2:#ffd36a;--border:#223247;--link:#87c4ff;--bubble-bot:#121e33;--bubble-border:#2a3b55;--bubble-user-bg:#1f86ff;--bubble-user-text:#fff;--bubble-user-border:#0f5fc3;--typing:#a9c7ff;--shadow:0 20px 44px rgba(0,0,0,.45);--shadow-soft:0 10px 28px rgba(0,0,0,.35)}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:"Open Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:0;display:flex;align-items:center;justify-content:center;font-size:clamp(14px,1.6vw,16px);min-height:100vh}
a{color:var(--link);text-decoration:none}a:hover{text-decoration:underline}
.app{width:100%;max-width:560px;background:var(--surface);border:3px solid var(--accent);border-radius:18px;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column;height:100vh;position:relative}
.header{background:var(--surface-2);border-bottom:1px solid var(--border);padding:10px 96px 10px 56px;position:relative;text-align:center}
.badge{display:inline-block;background:var(--brand);color:#fff;padding:8px 14px;border-radius:999px;font:700 13px/1 "Nunito",sans-serif;cursor:pointer}
.theme,.mic{position:absolute;top:8px;width:44px;height:44px;border:none;border-radius:999px;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--shadow-soft);cursor:pointer}
.mic{right:56px}.theme{right:8px}
.langbar{display:flex;gap:8px;justify-content:center;align-items:center;padding:8px;background:var(--surface-2);border-bottom:1px solid var(--border);flex-wrap:wrap}
.lang-label{font:700 12px/1 "Nunito",sans-serif;color:#5f6c80}
.lang-chip{display:inline-flex;align-items:center;justify-content:center;padding:8px 10px;border-radius:999px;min-width:44px;min-height:36px;border:1px solid rgba(0,0,0,.08);background:#fff;font-weight:700;font-size:12px;pointer-events:none;opacity:.85}
[data-theme="dark"] .lang-chip{background:#0f1926;border-color:#2b3a4e;color:#a7d7ff}
.rail{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;padding:10px;background:var(--surface-2);border-bottom:1px solid var(--border)}
.chip{display:inline-flex;align-items:center;gap:8px;font-weight:600;font-size:12px;color:var(--brand);border:1px solid rgba(255,145,31,.35);background:#fff;border-radius:999px;padding:9px 12px;min-height:40px;box-shadow:var(--shadow-soft)}
[data-theme="dark"] .chip{background:#0f1926;border-color:#2b3a4e;color:#a7d7ff}
.chat{flex:1;overflow-y:auto;overflow-x:hidden;padding:14px;padding-bottom:100px;overscroll-behavior:contain;-webkit-overflow-scrolling:touch;background:radial-gradient(70% 100% at -10% -20%,rgba(255,255,255,.06) 0%,rgba(255,255,255,0) 65%),radial-gradient(60% 90% at 110% 120%,rgba(255,255,255,.04) 0%,rgba(255,255,255,0) 60%),linear-gradient(180deg,var(--surface) 0%,var(--surface-2) 100%)}
.bubble{margin:12px 0;padding:12px 16px;border-radius:16px;line-height:1.45;border:1px solid var(--bubble-border);background:var(--bubble-bot);box-shadow:var(--shadow-soft);max-width:90%}
.bubble.bot{margin-right:20%}
.bubble.user{margin-left:20%;text-align:right;color:#fff;background:var(--bubble-user-bg);border:1px solid var(--bubble-user-border);border-radius:16px 16px 4px 16px}
.typing{display:inline-flex;gap:6px;align-items:flex-end}
.typing .dot{width:6px;height:6px;border-radius:50%;background:var(--typing);animation:bounce 1s infinite ease-in-out}
.typing .dot:nth-child(2){animation-delay:.12s}.typing .dot:nth-child(3){animation-delay:.24s}
@keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.6}40%{transform:translateY(-6px);opacity:1}}
.footer{position:absolute;bottom:0;left:0;right:0;padding:12px;background:var(--surface-2);border-top:1px solid var(--border);z-index:100}
.row{display:flex;gap:10px;align-items:center}
input[type="text"]{flex:1;padding:14px 16px;border:2px solid var(--border);border-radius:25px;font-size:16px;background:var(--surface);color:var(--text);caret-color:var(--accent)}
input::placeholder{color:var(--muted)}input:focus{border-color:var(--accent);outline:none}
.send{width:52px;height:52px;border:none;border-radius:50%;cursor:pointer;color:#222;font-size:18px;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--shadow-soft)}
.status{margin-top:6px;text-align:center;font-size:11px;color:var(--muted)}
.qrs{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.qr,.qr-link{background:var(--surface-2);border:1px solid var(--border);border-radius:999px;padding:8px 10px;font-size:12px;display:inline-flex;align-items:center;gap:6px;cursor:pointer}
.qr-link{text-decoration:none;color:inherit}
.note{font-size:11px;color:var(--muted);margin-top:6px}
</style>
</head>
<body>
<main class="app">
<header class="header">
<div class="badge" id="scrollTopBtn">TASK Assistant</div>
<button class="mic" id="micBtn" aria-label="Microphone">ğŸ™</button>
<button class="theme" id="themeToggle" aria-label="Toggle theme">â˜¼</button>
</header>
<div class="langbar">
<span class="lang-label">Language / Idioma / Lang:</span>
<span class="lang-chip" id="chipEN">EN</span>
<span class="lang-chip" id="chipES">ES</span>
<span class="lang-chip" id="chipHT">HT</span>
</div>
<nav class="rail">
<a class="chip" href="https://www.google.com/maps?q=72%201%2F2%20Escher%20St,%20Trenton,%20NJ%2008609" target="_blank">ğŸ“ Address</a>
<a class="chip" href="https://bycell.co/ddmtq" target="_blank">ğŸ’¼ Jobs</a>
<a class="chip" href="https://bycell.co/ddmtr" target="_blank">ğŸ”” Alerts</a>
<a class="chip" href="https://bycell.co/ddmtn" target="_blank">ğŸ“ Training</a>
<a class="chip" href="https://bycell.co/ddmui" target="_blank">ğŸ“„ Resume</a>
<a class="chip" href="https://www.youtube.com/watch?v=ZU9x1vFx5lI" target="_blank">ğŸ¥ Tips</a>
<a class="chip" href="https://bycell.co/ddmua" target="_blank">ğŸ§° Resources</a>
</nav>
<section class="chat" id="chat"></section>
<footer class="footer">
<div class="row">
<input id="box" type="text" placeholder="Type: training, jobs, hours, address, busâ€¦" autocomplete="off"/>
<button class="send" id="send" aria-label="Send">â¤</button>
</div>
<div class="status">âš ï¸ I can make mistakes â€” please double-check important info!</div>
</footer>
</main>
<script>
'use strict';
const UI = {
  en: {
    welcome: 'ğŸ‘‹ Hey there! I can help with training, jobs, appointments, hours, address, buses and more. Ask me anything.',
    q: 'Quick links:',
    hello: 'Hi! ğŸ‘‹ How can I help today?',
    thanks: "You're welcome! ğŸ˜Š Anything else?",
    bye: 'Take care! If you need to schedule, call (609) 337-1624.',
    noWalk: 'We do <strong>not</strong> take walk-ins. Please call to schedule. Same-day may be possible if you call first.',
    biNote: 'No caminatas / Pa san randevou',
    frust: 'ğŸ™ We know this can be frustrating. Let\'s get you real help now â€” call me at <a href="tel:6096976215">(609) 697-6215</a> or text <a href="sms:16096976215">(609) 697-6215</a>. For appointments call <a href="tel:6093371624">(609) 337-1624</a>.'
  },
  es: {
    welcome: 'ğŸ‘‹ Â¡Hola! Puedo ayudarte con entrenamientos, empleos, citas, horarios, direcciÃ³n, autobuses y mÃ¡s.',
    q: 'Enlaces rÃ¡pidos:',
    hello: 'Â¡Hola! ğŸ‘‹ Â¿En quÃ© te puedo ayudar hoy?',
    thanks: 'Â¡Con gusto! ğŸ˜Š Â¿Algo mÃ¡s?',
    bye: 'Â¡CuÃ­date! Si necesitas una cita, llama al (609) 337-1624.',
    noWalk: 'No atendemos <strong>sin cita</strong>. Por favor llama para programar.',
    biNote: 'No caminatas / Pa san randevou',
    frust: 'ğŸ™ Sabemos que esto puede ser frustrante. Consigue ayuda ya: llÃ¡mame al <a href="tel:6096976215">(609) 697-6215</a> o mÃ¡ndame un mensaje al <a href="sms:16096976215">(609) 697-6215</a>. Para citas llama al <a href="tel:6093371624">(609) 337-1624</a>.'
  },
  ht: {
    welcome: 'ğŸ‘‹ Bonjou! Mwen ka ede ak fÃ²masyon, travay, randevou, lÃ¨ yo, adrÃ¨s, otobis.',
    q: 'Lyen rapid:',
    hello: 'Bonjou! ğŸ‘‹ Kijan mwen ka ede w jodi a?',
    thanks: 'AvÃ¨k plezi! ğŸ˜Š Gen lÃ²t bagay?',
    bye: 'Si ou bezwen randevou, rele (609) 337-1624.',
    noWalk: 'Nou pa pran <strong>san randevou</strong>. Tanpri rele pou pran randevou.',
    biNote: 'No caminatas / Pa san randevou',
    frust: 'ğŸ™ Nou konprann sa ka fistran. Ann jwenn Ã¨d reyÃ¨l touswit â€” rele mwen nan <a href="tel:6096976215">(609) 697-6215</a> oswa voye tÃ¨ks nan <a href="sms:16096976215">(609) 697-6215</a>. Pou randevou rele <a href="tel:6093371624">(609) 337-1624</a>.'
  }
};

let lang = 'en';
const ce = id => document.getElementById(id);
const chat = ce('chat'), box = ce('box');
const en = ce('chipEN'), es = ce('chipES'), ht = ce('chipHT');
const theme = ce('themeToggle');

function setL(l) {
  lang = (l === 'es' || l === 'ht') ? l : 'en';
  en.style.opacity = lang === 'en' ? '1' : '.5';
  es.style.opacity = lang === 'es' ? '1' : '.5';
  ht.style.opacity = lang === 'ht' ? '1' : '.5';
}

// Safer detection using boundary-style groups (no fragile leading/trailing spaces)
function detectL(t) {
  const s = ` ${t.toLowerCase()} `;
  if (/(?:^|\s)(hola|gracias|cita|trabajo|empleo)(?:\s|$)/.test(s)) return 'es';
  if (/(?:^|\s)(bonjou|mesi|randevou|travay)(?:\s|$)/.test(s)) return 'ht';
  return 'en';
}

function addU(t){
  const e = document.createElement('div');
  e.className = 'bubble user';
  e.textContent = t;
  chat.appendChild(e);
  scroll();
}
function addB(h){
  const e = document.createElement('div');
  e.className = 'bubble bot';
  e.innerHTML = h;
  chat.appendChild(e);
  scroll();
}
function typ(on){
  const id = 'typing';
  if(on){
    const e = document.createElement('div');
    e.id = id; e.className = 'bubble bot';
    e.innerHTML = '<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>';
    chat.appendChild(e);
  } else {
    ce(id)?.remove();
  }
  scroll();
}
function scroll(){ requestAnimationFrame(()=>{ chat.scrollTop = chat.scrollHeight; }); }
function sec(t,b){ return `<div style="margin-bottom:10px"><strong>${t}</strong><br>${b}</div>`; }

function reply(intents, raw){
  const blocks = [];
  if (intents.includes('frust')) blocks.push(sec('ğŸ™', UI[lang].frust));
  if (intents.includes('greeting')) blocks.push(sec('ğŸ‘‹', UI[lang].hello));
  if (intents.includes('thanks')) blocks.push(sec('ğŸ˜Š', UI[lang].thanks));
  if (intents.includes('bye')) blocks.push(sec('ğŸ‘‹', UI[lang].bye));
  if (intents.includes('appt')) {
    let m = `Best way: call <a href="tel:6093371624">(609) 337-1624</a>.<br>${UI[lang].noWalk}<div class="note">${UI[lang].biNote}</div>`;
    m += `<br>If you can't get through, call me at <a href="tel:6096976215">(609) 697-6215</a> or text <a href="sms:16096976215">(609) 697-6215</a>.`;
    blocks.push(sec('ğŸ“… Appointment', m));
  }
  if (intents.includes('jobs')) blocks.push(sec('ğŸ’¼ Jobs', `<a href="https://bycell.co/ddmtq" target="_blank">Open positions</a><br><a href="https://bycell.co/ddmtr" target="_blank">Alerts</a><br>Call <a href="tel:6096976166">(609) 697-6166</a> or <a href="tel:6096976215">(609) 697-6215</a>.`));
  if (intents.includes('train')) blocks.push(sec('ğŸ“ Training', `<a href="https://bycell.co/ddmtn" target="_blank">Training</a><br>Call <a href="tel:6096976166">(609) 697-6166</a>.`));
  if (intents.includes('hours')) blocks.push(sec('ğŸ•’ Hours', 'Meals: Lunch Monâ€“Fri 10:30â€“1:00 â€¢ Dinner Monâ€“Thu 3:30â€“5:00'));
  if (intents.includes('loc')) {
    const map = 'https://www.google.com/maps?q=72%201%2F2%20Escher%20St,%20Trenton,%20NJ%2008609';
    blocks.push(sec('ğŸ“ Address', `72Â½ Escher St, Trenton, NJ 08609<br><a href="${map}" target="_blank">Open Map</a>`));
  }
  if (intents.includes('res')) blocks.push(sec('ğŸ“„ Resume', `<a href="https://bycell.co/ddmui" target="_blank">Templates</a><br>For help, call <a href="tel:6093371624">(609) 337-1624</a>.`));
  if (intents.includes('resource')) blocks.push(sec('ğŸ§° Resources', `<a href="https://bycell.co/ddmua" target="_blank">Community resources</a><br><a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank">What we do</a>`));
  if (blocks.length === 0) blocks.push(sec('ğŸ§° Resources', `<a href="https://bycell.co/ddmua" target="_blank">Community resources</a><br><a href="https://trentonsoupkitchen.org/what-we-do/" target="_blank">What we do</a>`));
  return blocks.join('<hr style="border:none;height:8px;background:transparent">');
}

function find(t){
  const hits = new Set();
  if (/\b(hi|hello|hey|hola|bonjou)\b/i.test(t)) hits.add('greeting');
  if (/\b(thanks|thank you|gracias|merci|mesi)\b/i.test(t)) hits.add('thanks');
  if (/\b(bye|goodbye|adios|ciao)\b/i.test(t)) hits.add('bye');
  if (/(wtf|sucks|useless|annoying|hate this|mad|angry|pissed|stupid|dumb|frustrated|no sirve|esto apesta|sa pa mache)/i.test(t)) hits.add('frust');
  if (/\b(appointment|appt|make|schedule|cita|randevou|walk[\s-]?in)\b/i.test(t)) hits.add('appt');
  if (/\b(job|jobs|employment|hiring|empleo|trabajo|travay)\b/i.test(t)) hits.add('jobs');
  if (/\b(training|program|class|certification|entrenamiento|fÃ²masyon)\b/i.test(t)) hits.add('train');
  if (/\b(hours|time|open|close|horario|lÃ¨)\b/i.test(t)) hits.add('hours');
  if (/\b(address|location|where|direccion|kote|adrÃ¨s)\b/i.test(t)) hits.add('loc');
  if (/\b(resume|cv|curriculum)\b/i.test(t)) hits.add('res');
  if (/\b(resource|services|benefits|snap|recursos|resous)\b/i.test(t)) hits.add('resource');
  return [...hits];
}

function handle(t){
  if(!t) return;
  setL(detectL(t));
  addU(t);
  typ(true);
  const i = find(t);
  setTimeout(()=>{ typ(false); addB(reply(i,t)); }, 220);
}

function send(){
  const t = (box.value||'').trim();
  if(!t) return;
  box.value = '';
  box.blur();
  handle(t);
  setTimeout(()=>box.focus(),100);
}

addB(`ğŸŸ¡ <strong>${UI[lang].welcome}</strong><br><br>${UI[lang].q} <a href="https://bycell.co/ddmtn" target="_blank">Training</a> â€¢ <a href="https://bycell.co/ddmtq" target="_blank">Jobs</a> â€¢ <a href="https://bycell.co/ddmtr" target="_blank">Alerts</a>`);
ce('send').addEventListener('click',send);
box.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); send(); }});
box.addEventListener('focus',()=>setTimeout(scroll,300));
ce('scrollTopBtn').addEventListener('click',()=>chat.scrollTo({top:0,behavior:'smooth'}));

theme.addEventListener('click',()=>{
  const d = document.documentElement.getAttribute('data-theme')==='dark';
  document.documentElement.setAttribute('data-theme', d ? 'light' : 'dark');
  theme.textContent = d ? 'â˜¼' : 'â˜¾';
  localStorage.setItem('task_theme', d ? 'light' : 'dark');
});
const saved = localStorage.getItem('task_theme');
if(saved){
  document.documentElement.setAttribute('data-theme', saved);
  theme.textContent = saved==='dark' ? 'â˜¾' : 'â˜¼';
}
</script>
</body>
</html>
